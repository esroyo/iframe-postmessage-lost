<!doctype HTML>
<html>
  <head>
    <title>Iframe</title>
  </head>
  <body>
    <h1>Hello, I'm an Iframe</h1>
    <p>Scott Isaacs invented me.</p>
    <script>
document.addEventListener('visibilitychange', (evt) => {
  try {
    if (evt.target.visibilityState === 'hidden') {
      console.log('[iframe] I have been hidden.');
      console.log('[iframe] Message my last words...');
      parent.postMessage({ msg: 'He has kill\'d me, mother: Run away, I pray you!' }, '*');
      console.log('[iframe] Beacon too:', navigator.sendBeacon('https://www.thehotelsnetwork.com/agent/probe'));
    }
  } catch (error) {
    console.error(error);
  }
});
    </script>
  </body>
</html>
